\chapter{実現}
\label{design}
\indent
\section{システム要件}
\label{sec:要件}
本システムの必要要件は以下の5点である．

\begin{itemize}
\item ユーザの識別結果の精度\\
　ユーザの識別結果の精度は重要である．
プロファイルの結果が曖昧であった場合，データ自体の信憑性が薄れてしまう．
利用者もプロファイル結果が信頼できないことを考慮しなければならず，負担が増える．
本システムは仮想ユーザのプロファイルによって得られる様々な集合知を取得することを目的としているため，
プロファイルの結果は可能な限り高精度であることが求められる．

\item 管理の容易性\\
　ネットワーク管理者が既存研究によってユーザのプロファイル作成を試みる場合，その負担は非常に大きなものとなる．
例えば，前述した802.1x認証などを導入・維持するための負担が挙げられる．
管理者の運用負担が増大すると，集合知を形成する動機が失われる可能性があるため，
管理負担の低減が必要である．

\item ユーザ識別の即時性\\
　目的とするユーザの識別は即時に行われる必要がある．
ユーザ全体のトレンドは刻々と変化するため，可能な限り短時間で把握することが望ましい．

\item ユーザの網羅性\\
　集合知は対象とするユーザの数によって集合知の価値が大きく変化するため，
より多くのユーザを対象とするべきである．
ユーザがシステムに登録する方法や特定のユーザのみから情報を収集する方法で獲得した集合知よりも，
可能な限り多く取得した情報を分析することで，より多くの集合知の取得が期待できる．

\end{itemize} 


\subsection{ユーザ識別に用いる情報}
\label{sec:識別情報} 
ユーザのプロファイル作成に用いる情報は，ユーザを推定できる情報である．
この情報は，各個人が持っている独特の傾向のことを指す．
同一ホストでもユーザの使用方法によって各個人は判別可能である．
その推定できる情報を組み合わせることによって仮想ユーザのプロファイルを作成する．
推定できる情報を以下に記述する．
\begin{itemize}
\item{\bf パケットヘッダ情報}\\
　各ユーザはそれぞれの利用状況に応じた特徴的なパケットを送受信している．
ヘッダ情報からは，
送信先・発信元IPアドレス，ポート番号から使用しているサービス，アプリケーションの使用頻度の情報が取得できる．
そして，送信先IPアドレスからはユーザの通信相手の情報が把握可能である
これによって，該当ユーザはどのようなホストとの通信する傾向があるかを把握できる.
そこで，本システムは各ユーザの送信先のリストを保持し，最も多くの通信をしている送信先ホストの上位を識別子とし，ユーザ識別を行う.
\begin{table}
\begin{center}
\caption{送信先IPアドレス上位リストの類似調査}
\label{tb:dst_IP}
\begin{tabular}{|c|c|c|c|}
\hline
 &UserA&UserB&UserC\\
\hline 
1回&1& 0 & 1\\
\hline 
2回&0& 1 & 0\\
\hline
\end{tabular}
\end{center}
\end{table}

　同時に，各ユーザの送信先IPアドレス上位はユーザの識別子となりえるのかの調査を行った．
調査したネットワークは筆者が所属する研究室でのネットワークであり，
取得期間は，2009年6月25日19時45分から22時20分までと7月12日0時46分から06時14分までである．
\\
　その結果は表\ref{tb:dst_IP}に示す．
各期間における調査対象のユーザの上位5位のリストうち，UserAとUserCは同じIPアドレス一つ，UserBに関しては
二つ見られた．
このことから，ユーザの送信先IPアドレス上位5位のリストはユーザの識別子の一つになることが期待できる．

また，ホストが利用する特徴的なプロトコルもユーザの識別子となる．
ホストとユーザは密接な関係があるため，ホストの識別はユーザの把握の一因となり得る．
そこで，本システムはパケットのヘッダ情報を利用してホストを識別する．
例えば，ホストがファイル共有やネットBIOS，プリンタの検索などを行った場合，
特徴的なパケットを出力する．この特徴を利用することによってホストを識別する．
\item{\bf 起動時間・接続頻度}\\
　ユーザがホストをネットワークに接続した時間や接続時間帯の規則性を記録して，
本人の生活習慣からもユーザの識別子となる．
人間の生活習慣は多少のぶれが生じるが，傾向を把握することによって，パターンを取得できる可能性がある．
そのため，ユーザがネットワークに接続する頻度やその接続時間はユーザの識別の材料となる．
これに加え，本システムはホストを起動時に一番最初に利用するプロトコルや通信傾向も識別子とする．

\item{\bf 接続位置}\\
　ネットワーク上の様々な位置に本システムを設置することによって，
ホストの接続位置を取得する．
これによって，ユーザの行動範囲を把握することが可能となる．

\item{\bf ユーザが利用するサービス}\\
　ユーザが利用する送信先アドレスや，ポート番号から分かるサービスを識別子とする．例えば，Webサービスを使用する場合，
利用しているWebサイトによってユーザをプロファイリングできる．
サービスの利用頻度や傾向はユーザごとに差異があるため，ユーザの識別子としても有効である．
このため，WebアプリケーションやSNSを利用する頻度や時間帯を各ユーザごとに調べることによって
類似するユーザを調査する.
例えば，mixi\cite{mixi:2009}やTwitter\cite{twitter:2009}などにアクセスする時間帯や間隔を各ユーザごとに
記録する.これらはユーザ特有の傾向であるためユーザ識別の識別子となりうる.
また，ユーザの所属するネットワークのMailサーバ，Webサーバへのアクセス情報も重要である.
そこで本研究は各ユーザのアプリケーションやサービスの利用頻度やアクセスする間隔に用いてユーザを識別する.

\item{\bf OSの種類}\\
　ユーザが主に使っているホストOSも十分な識別子となる．
IPヘッダやTCPヘッダを組み合わせて解析することによって，ユーザのOS情報を知ることができる．
Passive OS Fingerprintingを利用することによってユーザの所有しているホストを把握する.
\end{itemize} 

本システムは，大きく2つの動作に分けられる．
実ユーザのふるまいや特徴から仮想ユーザを作成し，実ユーザから仮想ユーザを推論するプロファイル動作と
プロファイル情報を用いて，トラフィックから各仮想ユーザの情報を収集し，各データベースに格納する動作である．
\begin{itemize}
\item{\bf 仮想ユーザのプロファイル情報の作成}\\
　まず，本システムはパケットを取得時に，パケットのIPアドレスと，仮想ユーザのプロファイル情報を比較する．
仮想ユーザのプロファイル情報に含まれるIPアドレスは，一定時間該当するIPアドレスから通信が発生しない場合削除される．
図\ref{fig:tree}で示すように，IPアドレスがマッチした場合，パケット情報は該当仮想ユーザのプロファイル情報に付与される．
もし，IPアドレスがマッチしなかった場合に，ポート番号や位置情報などパケットのIPアドレス以外の情報を参照し，
既存の仮想ユーザプロファイル情報と類似するかを調査する．
類似していた場合は，同じくそのパケットの情報を該当する仮想プロファイル情報に追加・更新する．
類似データが発見されなかった場合に，新しい仮想ユーザを作成する．
これを繰り返することによって，仮想ユーザやプロファイル情報を作成する．
\begin{figure}
    \begin{center}
      \includegraphics[scale=0.20]{./figure/tree.eps}
      \vspace{-5mm}
      \caption{ユーザプロファイル動作}
      \label{fig:tree}
    \end{center}
    \vspace{-5mm}
\end{figure}


\item{\bf 仮想ユーザのデータベースに格納する動作}\\
　本システムは，各仮想ユーザのプロファイル情報を用いて，トラフィックから情報を収集する．
仮想ユーザは保持しているプロファイル情報を用いてることで，トラフィック情報を分析する．
トラフィック情報が該当する仮想ユーザのデータであると判断すると，データベースに格納する．
これらを繰り返すことによって，仮想ユーザとトラフィック情報のマッピングを行う．
利用者は仮想ユーザとマッピングした情報を利用することで，集合知を獲得できる．
\end{itemize}

\section{動作概要}
\section{モジュール}
\subsection{IP判定モジュール}
\subsection{ホスト識別モジュール}
\subsection{学習モジュール}
\section{まとめ}
